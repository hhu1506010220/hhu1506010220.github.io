<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

	<!-- 百度统计 -->
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?e31627579358722b9d300535c8206351";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>

  <!--Description-->
  

  <!--Author-->
  
  <meta name="author" content="Vodkazy">
  

  <!--Open Graph Title-->
  
      <meta property="og:title" content="Linux &amp; Win &amp; Deepin 安装virtuoso数据库">
  
  <!--Open Graph Description-->
  
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="想飞的小菜鸡">
  <!--Type page-->
  
      <meta property="og:type" content="article">
  
  <!--Page Cover-->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- Title -->
  
  <title>Linux &amp; Win &amp; Deepin 安装virtuoso数据库 - 想飞的小菜鸡</title>


  <link rel="shortcut icon" href="/../images/icon.ico">
  <!--font-awesome-->
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <!-- Custom CSS/Sass -->
  <link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>


<body>

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Nav -->
  <header class="site-header">
  <div class="header-inside">
    
    <div class="logo">
      <a href="/" rel="home">
        
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn2.iconfinder.com/data/icons/weather-color-2/500/weather-01-128.png" alt="想飞的小菜鸡" height="60">
        
      </a>
    </div>
    <a class="header-name" href="/">
            <span>想飞的小菜鸡</span>
            的小窝
        </a>
    <!-- navbar -->
    <nav class="navbar">
      <!--  nav links -->
      <div class="collapse">
        <ul class="navbar-nav">
          
          
            <li>
              <a href="/.">
                
                  <i class="fa fa-home "></i>
                
                首页
              </a>
            </li>
          
            <li>
              <a href="/archives">
                
                  <i class="fa fa-archive "></i>
                
                目录
              </a>
            </li>
          
            <li>
              <a href="/project">
                
                  <i class="fa fa-folder-open "></i>
                
                代码库
              </a>
            </li>
          
            <li>
              <a href="/photo">
                
                  <i class="fa fa-photo "></i>
                
                相册薄
              </a>
            </li>
          
            <li>
              <a href="/lovetree">
                
                  <i class="fa fa-tree "></i>
                
                爱情树
              </a>
            </li>
          
            <li>
              <a href="/guestbook">
                
                  <i class="fa fa-edit "></i>
                
                留言板
              </a>
            </li>
          
            <li>
              <a href="/about">
                
                  <i class="fa fa-user "></i>
                
                关于我
              </a>
            </li>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div class="button-wrap">
      <button class="menu-toggle">Primary Menu</button>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="content-area">
  <div class="post">
    <!-- Post Content -->
    <div class="container">
      <article>
        <!-- Title date & tags -->
        <div class="post-header">
          <h1 class="entry-title">
            Linux & Win & Deepin 安装virtuoso数据库
            
          </h1>
         
        </div>
         <p class="a-posted-on">
          2018-11-19
          </p>
        <!-- Post Main Content -->
        <div class="entry-content">
          <p>Virtuoso数据库是一个高性能的rdf数据库,可支持百亿条三元组,支持sparql1.1语法查询。本文主要介绍了virtuoso数据库在linux和在windows下的安装方法，以及装载大文件的方法。<br><a id="more"></a></p>
<h2><span id="deepin安装">Deepin安装</span></h2><p>下载<a href="https://sourceforge.net/projects/virtuoso/files/virtuoso/7.2.5/virtuoso-opensource.x86_64-generic_glibc25-linux-gnu.tar.gz/download" target="_blank" rel="noopener">二进制包</a>进行安装。</p>
<p>下载完毕后将其解压到/usr/local下，添加一下环境变量，这可以让你直接在终端启动virtuoso数据库服务而无需cd到vituoso的bin目录下或加上路径之后再启动，比较方便。编辑/etc下的profile文件，在最后一行加上export VIRTUOSO_HOME=/usr/local/virtuoso-opensource，然后在PATH中加入virtuoso的路径${VIRTUOSO_HOME}/bin，PATH中的各个路径用冒号分隔。</p>
<p>设置完环境变量后重启一下。将virtuoso-openlink下的database文件夹中的virtuoso.ini.sample重命名为virtuoso.ini。然后启动终端，cd到database目录下，输入virtuoso-t -fd即可启动服务。在浏览器中输入<code>http://localhost:8890</code>进入8890端口网页即可打开其初始页面。点击conductor，输入用户名和密码（都是dba），可进入数据库服务页面。</p>
<p><a href="https://www.jb51.net/article/151486.htm" target="_blank" rel="noopener">安装教程</a></p>
<h3><span id="linux安装">Linux安装</span></h3><ul>
<li>下载源码，推荐从<a href="http://sourceforge.net/projects/virtuoso/files/virtuoso/" target="_blank" rel="noopener">sourceforge</a>下载，有可能版本不对就不行，建议下7.1.0版本，我用其他版本安装都会报错，下载zip或者tar.gz包都可以。</li>
<li>解压包，进入解压文件夹下，运行./autogen.sh，可以看见需要安装的依赖。</li>
<li><p>依赖安装如下：</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install libxml2-<span class="built_in">dev</span> libssl-<span class="built_in">dev</span> autoconf libgraphviz-<span class="built_in">dev</span> libmagickcore-<span class="built_in">dev</span> libmagickwand-<span class="built_in">dev</span> dnsutils gawk bison flex gperf</span><br></pre></td></tr></table></figure>
</li>
<li><p>再次运行./autogen.sh，检查一下依赖。</p>
</li>
<li><p>下面就是配置编译和安装，要花一段时间，尤其是编译。这里强烈建议把prefix设定在usr文件夹下，我之前想放在别的地方但是都出了很多问题，所以放在usr下最保险。默认prefix的路径是/usr/local/，如果-prefix报错可以不加。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure -<span class="built_in">prefix</span>=/usr/<span class="built_in">local</span>/ -<span class="built_in">program</span>-<span class="built_in">transform</span>-name=<span class="string">"s/isql/isql-v/"</span>(这句话的意思是以后可以用isql-v启动isql)</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装好以后，默认的db在/usr/local/var/lib/virtuoso-opensource-7/db，我们要给一下权限，不然会报错。</p>
</li>
<li>然后进入db目录，启动：virtuoso-t -fd，启动之后就可以进入8890端口网页看看了。进入isql的命令是isql或者isql 1111 dba dba （默认的管理员和密码，可以修改），退出是exit;，停止服务是shutdown();。</li>
</ul>
<h3><span id="windows安装">Windows安装</span></h3><p>大体思路是安装先C++驱动，然后解压virtuoso source文件，在环境变量中设置VIRTUOSO_HOME和PATH两个环境变量。利用命令行对virtuoso数据库进行操作。</p>
<ul>
<li>解压virtuoso-opensource到指定目录，比如c:\virtuoso</li>
<li>安装VC++2012、VC++2010插件补丁</li>
<li>设置环境变量。键VIRTUOSO_HOME值【;c:\virtuoso;】键PATH值【;%VIRTUOSO_HOME%/bin;%VIRTUOSO%/lib;】</li>
<li>测试virtuoso环境变量，cmd进入命令行模式，输入virtuoso-t -?，显示virtuoso的帮助信息。</li>
<li><p>切换到c:\virtuoso\database目录，创建virtuoso的服务。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtuoso-t +service create +<span class="keyword">instance </span>“<span class="keyword">InstanceName” </span>+configfile virtuoso.ini</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务。在服务管理中设置为自动。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtuoso-t +<span class="keyword">instance </span>“<span class="keyword">InstanceName” </span>+service start。</span><br></pre></td></tr></table></figure>
</li>
<li><p>此时在本地用localhost:8890，可以访问。在win10中访问虚拟机中的virtuoso，如果能ping通，但是不能访问win2008中的virtuoso数据库，则需要在win2008中配置策略，控制面板—windows防火墙—高级设置—入站规则，在右侧空白处点击右键新建规则，放开8890和1111端口的配置，这样就能够正常访问使用8890和1111端口的virtuoso数据库了。</p>
</li>
<li>如果开机后未启动该服务，手动启动也不能成功的话，需要删掉virtuoso/database中的virtuoso.lck文件，然后就可以启动了。</li>
</ul>
<h3><span id="virtuosoini设置">virtuoso.ini设置</span></h3><p>位于database文件夹下的ini文件是关于数据库的设置文件。<br>主要用的就是DirsAllowed 、NumberOfBuffers 和 MaxDirtyBuffers。</p>
<ul>
<li>DirsAllowed是设置的允许访问的路径，如果要自己从某一个地方导入一个数据的话，要先把这个数据的位置加入到DirsAllowed里面去。</li>
<li>NumberOfBuffers 和 MaxDirtyBuffers 设置的是分配给virtuoso的内存和其他系统资源。参照下图。<br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="./1.jpg" alt=""></li>
</ul>
<h3><span id="导入数据">导入数据</span></h3><ul>
<li><p>新建导入需要的procedure。去官网下载VirtBulkRDFLoaderScript.vsql，在其所在目录下进入isql模式，然后 load VirtBulkRDFLoaderScript.vsql 。或者isql 1111 dba dba VirtBulkRDFLoaderScript.vsql 直接运行脚本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE load_list (</span><br><span class="line">  ll_file      VARCHAR,</span><br><span class="line">  ll_graph     VARCHAR,</span><br><span class="line">  ll_state     INT DEFAULT 0, -- 0 not started, 1 going, 2 done</span><br><span class="line">  ll_started   DATETIME,</span><br><span class="line">  ll_done      DATETIME,</span><br><span class="line">  ll_host      INT,</span><br><span class="line">  ll_work_time INTEGER,</span><br><span class="line">  ll_error     VARCHAR,</span><br><span class="line">  PRIMARY KEY (ll_file))</span><br><span class="line">ALTER INDEX load_list ON load_list PARTITION (ll_file VARCHAR)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">CREATE INDEX ll_state ON load_list (ll_state, ll_file, ll_graph) PARTITION (ll_state INT)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE ldlock (id INT PRIMARY KEY)</span><br><span class="line">  ALTER INDEX ldlock ON ldlock PARTITION (id INT)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">INSERT INTO ldlock VALUES (0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE</span><br><span class="line">ld_dir (IN path VARCHAR, IN mask VARCHAR, IN graph VARCHAR)</span><br><span class="line">&#123;</span><br><span class="line">  DECLARE ls ANY;</span><br><span class="line">  DECLARE inx INT;</span><br><span class="line">  ls := sys_dirlist (path, 1);</span><br><span class="line">  FOR (inx := 0; inx &lt; LENGTH (ls); inx := inx + 1)</span><br><span class="line">    &#123;</span><br><span class="line">      IF (ls[inx] LIKE mask)</span><br><span class="line">	&#123;</span><br><span class="line">	  SET ISOLATION = &apos;serializable&apos;;</span><br><span class="line"></span><br><span class="line">	  IF (NOT (EXISTS (SELECT 1 FROM DB.DBA.LOAD_LIST WHERE LL_FILE = path || &apos;/&apos; || ls[inx] FOR UPDATE)))</span><br><span class="line">	    &#123;</span><br><span class="line">	      DECLARE gfile, cgfile, ngraph VARCHAR;</span><br><span class="line">	      gfile := path || &apos;/&apos; || REPLACE (ls[inx], &apos;.gz&apos;, &apos;&apos;) || &apos;.graph&apos;;</span><br><span class="line">	      cgfile := path || &apos;/&apos; || regexp_replace (REPLACE (ls[inx], &apos;.gz&apos;, &apos;&apos;), &apos;\\-[0-9]+\\.n&apos;, &apos;.n&apos;) || &apos;.graph&apos;;</span><br><span class="line">	      IF (file_stat (gfile) &lt;&gt; 0)</span><br><span class="line">		ngraph := TRIM (file_to_string (gfile), &apos; \r\n&apos;);</span><br><span class="line">              ELSE IF (file_stat (cgfile) &lt;&gt; 0)</span><br><span class="line">		ngraph := TRIM (file_to_string (cgfile), &apos; \r\n&apos;);</span><br><span class="line">	      ELSE IF (file_stat (path || &apos;/&apos; || &apos;global.graph&apos;) &lt;&gt; 0)</span><br><span class="line">		ngraph := TRIM (file_to_string (path || &apos;/&apos; || &apos;global.graph&apos;), &apos; \r\n&apos;);</span><br><span class="line">	      ELSE</span><br><span class="line">	        ngraph := graph;	</span><br><span class="line">              IF (ngraph IS NOT NULL)</span><br><span class="line">                &#123;		</span><br><span class="line">		  INSERT INTO DB.DBA.LOAD_LIST (ll_file, ll_graph) VALUES (path || &apos;/&apos; || ls[inx], ngraph);</span><br><span class="line">		&#125;</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">	  COMMIT WORK;</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE</span><br><span class="line">rdf_read_dir (IN path VARCHAR, IN mask VARCHAR, IN graph VARCHAR)</span><br><span class="line">&#123;</span><br><span class="line">  ld_dirr (path, mask, graph);</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE </span><br><span class="line">ld_dir_all (IN path VARCHAR, IN mask VARCHAR, IN graph VARCHAR)</span><br><span class="line">&#123;</span><br><span class="line">  DECLARE ls ANY;</span><br><span class="line">  DECLARE inx INT;</span><br><span class="line">  ls := sys_dirlist (path, 0);</span><br><span class="line">  ld_dir (path, mask, graph);</span><br><span class="line">  FOR (inx := 0; inx &lt; LENGTH (ls); inx := inx + 1)</span><br><span class="line">    &#123;</span><br><span class="line">      IF (ls[inx] &lt;&gt; &apos;.&apos; AND ls[inx] &lt;&gt; &apos;..&apos;)</span><br><span class="line">	&#123;</span><br><span class="line">	  ld_dir_all (path||&apos;/&apos;||ls[inx], mask, graph);</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE</span><br><span class="line">ld_add (IN _fname VARCHAR, IN _graph VARCHAR)</span><br><span class="line">&#123;</span><br><span class="line">  --log_message (sprintf (&apos;ld_add: %s, %s&apos;, _fname, _graph));</span><br><span class="line"></span><br><span class="line">  SET ISOLATION = &apos;serializable&apos;;</span><br><span class="line"></span><br><span class="line">  IF (NOT (EXISTS (SELECT 1 FROM DB.DBA.LOAD_LIST WHERE LL_FILE = _fname FOR UPDATE)))</span><br><span class="line">    &#123;</span><br><span class="line">      INSERT INTO DB.DBA.LOAD_LIST (LL_FILE, LL_GRAPH) VALUES (_fname, _graph);</span><br><span class="line">    &#125;</span><br><span class="line">  COMMIT WORK;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE </span><br><span class="line">ld_ttlp_flags (IN fname VARCHAR)</span><br><span class="line">&#123;</span><br><span class="line">  IF (fname LIKE &apos;%/btc-2009%&apos; OR fname LIKE &apos;%.nq%&apos; OR fname LIKE &apos;%.n4&apos;)</span><br><span class="line">    RETURN 255 + 512;</span><br><span class="line">  RETURN 255;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE</span><br><span class="line">ld_file (IN f VARCHAR, IN graph VARCHAR)</span><br><span class="line">&#123;</span><br><span class="line">  DECLARE gzip_name VARCHAR;</span><br><span class="line">  DECLARE exit handler FOR sqlstate &apos;*&apos; &#123;</span><br><span class="line">    ROLLBACK WORK;</span><br><span class="line">    UPDATE DB.DBA.LOAD_LIST</span><br><span class="line">      SET LL_STATE = 2,</span><br><span class="line">          LL_DONE = CURDATETIME (),</span><br><span class="line">          LL_ERROR = __sql_state || &apos; &apos; || __sql_message</span><br><span class="line">      WHERE LL_FILE = f;</span><br><span class="line">    COMMIT WORK;</span><br><span class="line"></span><br><span class="line">    log_message (sprintf (&apos; File %s error %s %s&apos;, f, __sql_state, __sql_message));</span><br><span class="line">    RETURN;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  IF (f LIKE &apos;%.grdf&apos; OR f LIKE &apos;%.grdf.gz&apos;)</span><br><span class="line">    &#123;</span><br><span class="line">      load_grdf (f);</span><br><span class="line">    &#125;</span><br><span class="line">  ELSE IF (f LIKE &apos;%.gz&apos;)</span><br><span class="line">    &#123;</span><br><span class="line">      gzip_name := regexp_replace (f, &apos;\.gz\x24&apos;, &apos;&apos;);</span><br><span class="line">      IF (gzip_name LIKE &apos;%.xml&apos; OR gzip_name LIKE &apos;%.owl&apos; OR gzip_name LIKE &apos;%.rdf&apos;)</span><br><span class="line">	DB.DBA.RDF_LOAD_RDFXML (gz_file_open (f), graph, graph);</span><br><span class="line">      ELSE</span><br><span class="line">	TTLP (gz_file_open (f), graph, graph, ld_ttlp_flags (gzip_name));</span><br><span class="line">    &#125;</span><br><span class="line">  ELSE</span><br><span class="line">    &#123;</span><br><span class="line">      IF (f LIKE &apos;%.xml&apos; OR f LIKE &apos;%.owl&apos; OR f LIKE &apos;%.rdf&apos;)</span><br><span class="line">	DB.DBA.RDF_LOAD_RDFXML (file_open (f), graph, graph);</span><br><span class="line">      ELSE</span><br><span class="line">	TTLP (file_open (f), graph, graph, ld_ttlp_flags (f));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  --log_message (sprintf (&apos;loaded %s&apos;, f));</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE</span><br><span class="line">rdf_load_dir (IN path VARCHAR,</span><br><span class="line">              IN mask VARCHAR := &apos;%.nt&apos;,</span><br><span class="line">              IN graph VARCHAR := &apos;http://dbpedia.org&apos;)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  DELETE FROM DB.DBA.LOAD_LIST WHERE LL_FILE = &apos;##stop&apos;;</span><br><span class="line">  COMMIT WORK;</span><br><span class="line"></span><br><span class="line">  ld_dir (path, mask, graph);</span><br><span class="line"></span><br><span class="line">  rdf_loader_run ();</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE </span><br><span class="line">ld_array ()</span><br><span class="line">&#123;</span><br><span class="line">  DECLARE first, last, arr, len, local ANY;</span><br><span class="line">  DECLARE cr CURSOR FOR</span><br><span class="line">      SELECT TOP 100 LL_FILE, LL_GRAPH</span><br><span class="line">        FROM DB.DBA.LOAD_LIST TABLE OPTION (INDEX ll_state)</span><br><span class="line">        WHERE LL_STATE = 0</span><br><span class="line">	FOR UPDATE;</span><br><span class="line">  DECLARE fill INT;</span><br><span class="line">  DECLARE f, g VARCHAR;</span><br><span class="line">  DECLARE r ANY;</span><br><span class="line">  WHENEVER NOT FOUND GOTO done;</span><br><span class="line">  first := 0;</span><br><span class="line">  last := 0;</span><br><span class="line"> arr := make_array (100, &apos;any&apos;);</span><br><span class="line">  fill := 0;</span><br><span class="line">  OPEN cr;</span><br><span class="line">  len := 0;</span><br><span class="line">  FOR (;;)</span><br><span class="line">    &#123;</span><br><span class="line">      FETCH cr INTO f, g;</span><br><span class="line">      IF (0 = first) first := f;</span><br><span class="line">      last := f;</span><br><span class="line">      arr[fill] := VECTOR (f, g);</span><br><span class="line">    len := len + CAST (file_stat (f, 1) AS INT);</span><br><span class="line">      fill := fill + 1;</span><br><span class="line">      IF (len &gt; 2000000)</span><br><span class="line">	GOTO done;</span><br><span class="line">    &#125;</span><br><span class="line"> done:</span><br><span class="line">  IF (0 = first)</span><br><span class="line">    RETURN 0;</span><br><span class="line">  IF (1 &lt;&gt; sys_stat (&apos;cl_run_local_only&apos;)) </span><br><span class="line">    local := sys_stat (&apos;cl_this_host&apos;);</span><br><span class="line">  UPDATE load_list SET ll_state = 1, ll_started = CURDATETIME (), LL_HOST = local</span><br><span class="line">    WHERE ll_file &gt;= first AND ll_file &lt;= last;</span><br><span class="line">  RETURN arr;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE</span><br><span class="line">rdf_loader_run (IN max_files INTEGER := NULL, IN log_enable INT := 2)</span><br><span class="line">&#123;</span><br><span class="line">  DECLARE sec_delay float;</span><br><span class="line">  DECLARE _f, _graph VARCHAR;</span><br><span class="line">  DECLARE arr ANY;</span><br><span class="line">  DECLARE xx, inx, tx_mode, ld_mode INT;</span><br><span class="line">  ld_mode := log_enable;</span><br><span class="line">  IF (0 = sys_stat (&apos;cl_run_local_only&apos;))</span><br><span class="line">    &#123;</span><br><span class="line">      IF (log_enable = 2 AND cl_this_host () = 1)</span><br><span class="line">	&#123;</span><br><span class="line">	  cl_exec (&apos;checkpoint_interval (0)&apos;);</span><br><span class="line">	  cl_exec (&apos;__dbf_set (&apos;&apos;cl_non_logged_write_mode&apos;&apos;, 1)&apos;);</span><br><span class="line">	&#125;</span><br><span class="line">      IF (cl_this_host () = 1)</span><br><span class="line">	cl_exec(&apos;__dbf_set(&apos;&apos;cl_max_keep_alives_missed&apos;&apos;,3000)&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">  tx_mode := bit_and (1, log_enable);</span><br><span class="line">  log_message (&apos;Loader started&apos;);</span><br><span class="line"></span><br><span class="line">  DELETE FROM DB.DBA.LOAD_LIST WHERE LL_FILE = &apos;##stop&apos;;</span><br><span class="line">  COMMIT WORK;</span><br><span class="line"></span><br><span class="line">  WHILE (1)</span><br><span class="line">    &#123;</span><br><span class="line">      SET ISOLATION = &apos;repeatable&apos;;</span><br><span class="line">      DECLARE exit handler FOR sqlstate &apos;40001&apos; &#123;</span><br><span class="line">	ROLLBACK WORK;</span><br><span class="line">        sec_delay := RND(1000)*0.001;</span><br><span class="line">	log_message(sprintf(&apos;deadlock in loader, waiting %d milliseconds&apos;, CAST (sec_delay * 1000 AS INTEGER)));</span><br><span class="line">	delay(sec_delay);</span><br><span class="line">	GOTO again;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">     again:;</span><br><span class="line"></span><br><span class="line">      IF (EXISTS (SELECT 1 FROM DB.DBA.LOAD_LIST WHERE LL_FILE = &apos;##stop&apos;))</span><br><span class="line">	&#123;</span><br><span class="line">	  log_message (&apos;File load stopped by rdf_load_stop.&apos;);</span><br><span class="line">	  RETURN;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">      log_enable (tx_mode, 1);</span><br><span class="line"></span><br><span class="line">      IF (max_files IS NOT NULL AND max_files &lt;= 0)</span><br><span class="line">        &#123;</span><br><span class="line">	  COMMIT WORK;</span><br><span class="line">	  log_message (&apos;Max_files reached. Finishing.&apos;);</span><br><span class="line">          RETURN;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">      WHENEVER NOT FOUND GOTO looks_empty;</span><br><span class="line"></span><br><span class="line">      --      log_message (&apos;Getting next file.&apos;);</span><br><span class="line">      SET ISOLATION = &apos;serializable&apos;;</span><br><span class="line">      SELECT id INTO xx FROM ldlock WHERE id = 0 FOR UPDATE;</span><br><span class="line">      arr := ld_array ();</span><br><span class="line">      COMMIT WORK;</span><br><span class="line">      IF (0 = arr)</span><br><span class="line">	GOTO looks_empty;</span><br><span class="line">      log_enable (ld_mode, 1);</span><br><span class="line"></span><br><span class="line">      FOR (inx := 0; inx &lt; 100; inx := inx + 1)</span><br><span class="line">	&#123;</span><br><span class="line">	  IF (0 = arr[inx])</span><br><span class="line">	    GOTO arr_done;</span><br><span class="line">	  ld_file (arr[inx][0], arr[inx][1]);</span><br><span class="line">	  UPDATE DB.DBA.LOAD_LIST SET LL_STATE = 2, LL_DONE = CURDATETIME () WHERE LL_FILE = arr[inx][0];</span><br><span class="line">	&#125;</span><br><span class="line">    arr_done:</span><br><span class="line">      log_enable (tx_mode, 1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      IF (max_files IS NOT NULL) max_files := max_files - 100;</span><br><span class="line"></span><br><span class="line">      COMMIT WORK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> looks_empty:</span><br><span class="line">  COMMIT WORK;</span><br><span class="line">  log_message (&apos;No more files to load. Loader has finished,&apos;);</span><br><span class="line">  RETURN;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE </span><br><span class="line">rdf_load_stop (IN force INT := 0)</span><br><span class="line">&#123;</span><br><span class="line">  INSERT INTO DB.DBA.LOAD_LIST (LL_FILE) VALUES (&apos;##stop&apos;);</span><br><span class="line">  COMMIT WORK;</span><br><span class="line">  IF (force)</span><br><span class="line">    cl_exec (&apos;txn_killall (1)&apos;);</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE </span><br><span class="line">RDF_LOADER_RUN_1 (IN x INT, IN y INT)</span><br><span class="line">&#123;</span><br><span class="line">  rdf_loader_run (x, y);</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE </span><br><span class="line">rdf_ld_srv (IN log_enable INT)</span><br><span class="line">&#123;</span><br><span class="line">  DECLARE aq ANY;</span><br><span class="line">  aq := async_queue (1);</span><br><span class="line">  aq_request (aq, &apos;DB.DBA.RDF_LOADER_RUN_1&apos;, VECTOR (NULL, log_enable));</span><br><span class="line">  aq_wait_all (aq);</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE </span><br><span class="line">load_grdf (IN f VARCHAR)</span><br><span class="line">&#123;</span><br><span class="line">  DECLARE line ANY;</span><br><span class="line">  DECLARE inx INT;</span><br><span class="line">  DECLARE ses ANY;</span><br><span class="line">  DECLARE gr VARCHAR;</span><br><span class="line"></span><br><span class="line">  IF (f LIKE &apos;%.gz&apos;)</span><br><span class="line">    ses := gz_file_open (f);</span><br><span class="line">  ELSE</span><br><span class="line">    ses := file_open (f);</span><br><span class="line">  inx := 0;</span><br><span class="line">  line := &apos;&apos;;</span><br><span class="line">  WHILE (line &lt;&gt; 0)</span><br><span class="line">    &#123; </span><br><span class="line">      gr := ses_read_line (ses, 0, 0, 1);</span><br><span class="line">      IF (gr = 0) RETURN;</span><br><span class="line">      line := ses_read_line (ses, 0, 0, 1);</span><br><span class="line">      IF (line = 0) RETURN;</span><br><span class="line">      DB.DBA.RDF_LOAD_RDFXML (line, gr, gr);</span><br><span class="line">      inx := inx + 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">-- cl_exec (&apos;set lock_escalation_pct = 110&apos;);</span><br><span class="line">-- cl_exec (&apos;DB.DBA.RDF_LD_SRV (1)&apos;) &amp;</span><br><span class="line">-- cl_exec (&apos;DB.DBA.RDF_LD_SRV (2)&apos;) &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>准备数据，把需要导入的数据放在某个目录下，假定是../data，则在isql模式下敲入</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ld_dir_all</span>(<span class="string">'../data'</span>, <span class="string">'*.*'</span>,<span class="string">'http://dbpedia.org'</span>);</span><br><span class="line"># 第一个参数是文件目录，第二个参数是全部文件，第三个参数是<span class="selector-tag">named</span> <span class="selector-tag">graph</span>名称。</span><br><span class="line"># <span class="selector-tag">ld_dir</span>() 里面的目录不包括子目录，<span class="selector-tag">ld_dir_all</span>() 命令包括所有的子目录。添加单个文件是<span class="selector-tag">ld_add</span>(文件，graph名称)。</span><br></pre></td></tr></table></figure>
</li>
<li><p>这样就有一个导入任务了，这时候这些文件已经在load-list表里面了，执行以下语句可以看见具体表的内容。用DB.DBA.load-list来查看注册的数据集装载情况和图标识名正在加载还是已经加载。ll_state字段有三个值：0表示数据集还没有加载；1表示数据集正在加载中；2表示数据集已经加载完成。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> DB.DBA.LOAD_LIST;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后，通过rdf-loader-run()命令完成大文件数据的加载。该命令执行后，如果文件比较大，会是一个漫长的等待过程，耐心等待，可以先不管他，做其他的工作去吧。漫长等待之后，如果装载成功，会有一个花费时间的显示。如果查看导入情况，可以另外打开一个cmd，然后进入isql再执行上述语句。</p>
</li>
<li>导入完成之后，需要清理一下load-list，否则下次装载其他文件时，load-list里面的文件还会导入。清理命令是delete from db.dba.load_list;后续处理：checkpoint;commit WORK;checkpoint;等等</li>
</ul>
<h3><span id="virtuoso操作graph的方法删除和查询">virtuoso操作graph的方法——删除和查询</span></h3><ul>
<li><p>查询graph的命令<br>在localhost:8890/conductor中，通过dba/dba登录之后，到sparql界面。或者localhost:8890/sparql进入查询界面，然后键入以下命令就可以得到全部的graph列表。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct <span class="string">?g</span> where &#123;graph <span class="string">?g</span>&#123;<span class="string">?s</span> <span class="string">?p</span> <span class="string">?o</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除graph的操作<br>删除某个graph，需要在isql中进行，在cmd中，进入到virtuoso的database目录，然后键入isql，进入sql命令环境，然后依次键入下面的命令，即可删除graph-name的graph。因为删除graph涉及到事务的处理，所以需要在删除graph之前，设置事务的自动提交，通过log_enable(3,1);这个命令完成对事务的处理。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log_enable(<span class="number">3</span>,<span class="number">1</span>);</span><br><span class="line">SPARQL <span class="keyword">CLEAR</span> <span class="keyword">GRAPH</span>  &lt;<span class="keyword">graph</span>-name&gt;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询graph的所有数据</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">对某个uri进行操作</span><br><span class="line">SELECT <span class="string">?s</span></span><br><span class="line">WHERE &#123;</span><br><span class="line">  <span class="string">?s</span> <span class="string">?p</span> <span class="string">?o</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>参考网址：<br><a href="https://virtuoso.openlinksw.com/howto/" target="_blank" rel="noopener">官网</a><br><a href="http://vos.openlinksw.com/owiki/wiki/VOS/VirtBulkRDFLoaderScript" target="_blank" rel="noopener">VirtBulkRDFLoaderScript</a></p>
<blockquote>
<p>本文来源：「想飞的小菜鸡」的个人网站  <a href="https://vodkazy.cn" target="_blank" rel="noopener">vodkazy.cn</a></p>
<p>版权声明：本文为「想飞的小菜鸡」的原创文章，采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请附上原文出处链接及本声明。</p>
<p>原文链接：<a href="https://vodkazy.cn/2018/11/19/Linux&amp;Win&amp;Deepin安装virtuoso数据库" target="_blank" rel="noopener">https://vodkazy.cn/2018/11/19/Linux&amp;Win&amp;Deepin安装virtuoso数据库</a></p>
</blockquote>

        </div>
      </article>
    </div>

	<!-- 打赏 -->
    <div class="reward">
	<div class="reward-button">赏 <span class="reward-code">
		<span class="alipay-code"> <img class="alipay-img wdp-appear" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/alipay.webp"><b>支付宝打赏</b> </span> 
		<span class="wechat-code"> <img class="wechat-img wdp-appear" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/weixin.webp"><b>微信打赏</b> </span> </span>
	</div>
	<p class="reward-notice">如果文章对你有帮助，欢迎点击上方按钮打赏作者，更多文章请访问<a href="https://vodkazy.cn" style="color:blue">想飞的小菜鸡</a></p>
	    <style>
		*,*:before,*:after {
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			-ms-box-sizing: border-box;
			box-sizing: border-box
		}

		.reward {
			padding: 5px 0
		}

		.reward .reward-notice {
			font-size: 14px;
			line-height: 14px;
			margin: 15px auto;
			text-align: center
		}

		.reward .reward-button {
			font-size: 28px;
			line-height: 58px;
			position: relative;
			display: block;
			width: 60px;
			height: 60px;
			margin: 0 auto;
			padding: 0;
			-webkit-user-select: none;
			text-align: center;
			vertical-align: middle;
			color: #fff;
			border: 1px solid #f1b60e;
			border-radius: 50%;
			background: #fccd60;
			background: -webkit-gradient(linear,left top,left bottom,color-stop(0,#fccd60),color-stop(100%,#fbae12),color-stop(100%,#2989d8),color-stop(100%,#207cca));
			background: -webkit-linear-gradient(top,#fccd60 0,#fbae12 100%,#2989d8 100%,#207cca 100%);
			background: linear-gradient(to bottom,#fccd60 0,#fbae12 100%,#2989d8 100%,#207cca 100%)
		}

		.reward .reward-code {
			position: absolute;
			top: -220px;
			left: 50%;
			display: none;
			width: 350px;
			height: 200px;
			margin-left: -175px;
			padding: 15px;
			border: 1px solid #e6e6e6;
			background: #fff;
			box-shadow: 0 1px 1px 1px #efefef
		}

		.reward .reward-button:hover .reward-code {
			display: block
		}

		.reward .reward-code span {
			display: inline-block;
			width: 150px;
			height: 150px
		}

		.reward .reward-code span.alipay-code {
			float: left
		}

		.reward .reward-code span.alipay-code a {
			padding: 0
		}

		.reward .reward-code span.wechat-code {
			float: right
		}

		.reward .reward-code img {
			display: inline-block;
			float: left;
			width: 150px;
			height: 150px;
			margin: 0 auto;
			border: 0
		}

		.reward .reward-code b {
			font-size: 14px;
			line-height: 26px;
			display: block;
			margin: 0;
			text-align: center;
			color: #666
		}

		.reward .reward-code b.notice {
			line-height: 2rem;
			margin-top: -1rem;
			color: #999
		}

		.reward .reward-code:after,.reward .reward-code:before {
			position: absolute;
			content: '';
			border: 10px solid transparent
		}

		.reward .reward-code:after {
			bottom: -19px;
			left: 50%;
			margin-left: -10px;
			border-top-color: #fff
		}

		.reward .reward-code:before {
			bottom: -20px;
			left: 50%;
			margin-left: -10px;
			border-top-color: #e6e6e6
		}
    </style>


    <!-- Pre or Next -->
    
	<div class="container">
           <ul class="pager">
    	     
      	     <li class="previous">
              <a href="/2018/11/23/SPARQL学习笔记（一）/" rel="prev">上一篇</a>
             </li>
           
           
              <li class="next">
              <a href="/2018/11/09/迁移博客至Ubuntu的一些坑/" rel="prev">下一篇</a>
            </li>
           
          </ul>
       </div>
   

    <!-- Valine无后端评论系统 -->   
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
    <div id="vcomments"></div>
    <script>
        new Valine({
		    el: '#vcomments' ,
		    appId: 'lH3VkMCd4MHaKtr2n2SRWdoi-MdYXbMMI',
		    appKey: '5aMXSY7b4KwnzfgpzLA0hPLv',
		    notify:true, 
		    verify:false, 
		    placeholder: '填写正确的邮箱和昵称才能收到我的回复哦       ٩( ^o^ )و  ' ,
		    avatar: 'retro'
		});
    </script>
    <!-- Valine无后端评论系统 -->  

  </div>
</div>
</div>

  <!-- Footer -->
  <!-- Footer -->
<footer class="site-info">
  <p>
    <span>想飞的小菜鸡 &copy; 2021</span>
    
      <span class="split">|</span>
      <span>照耀的Blog</span>
    
  </p>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
    本站访客数<span id="busuanzi_value_site_uv"></span>人次
    本文总阅读量<span id="busuanzi_value_page_pv"></span>次
</footer>

  <!-- After footer scripts -->
  <!-- scripts -->
<script src="/js/app.js"></script>


 
  <!-- 使用 aotuload.js 引入看板娘 -->    
  <!-- //<script src="/js/assets/jquery.min.js?v=3.3.1"></script> -->   
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
  <!-- //<script src="/js/assets/jquery-ui.min.js?v=1.12.1"></script>   --> 
  <script src="https://cdn.jsdelivr.net/npm/jquery-ui-dist@1.12.1/jquery-ui.min.js"></script>
  <script src="/js/assets/autoload.js?v=1.4.2"></script>
  <!-- //<script src="https://live2d-cdn.fghrsh.net/assets/1.4.2/autoload.js></script> -->   
   


<script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var i=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){i&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,e,a=0;a<r.length;a++)t=r[a],e=void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body>

</html>
